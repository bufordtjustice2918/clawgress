<?xml version="1.0" encoding="UTF-8"?>
<!-- flow-accounting configuration -->
<interfaceDefinition>
  <node name="system">
    <children>
      <node name="flow-accounting" owner="${vyos_conf_scripts_dir}/system_flow-accounting.py">
        <properties>
          <help>Flow accounting settings</help>
          <priority>990</priority>
        </properties>
        <children>
          <leafNode name="enable-egress">
            <properties>
              <help>Enable egress flow accounting</help>
              <valueless/>
            </properties>
          </leafNode>
          <node name="netflow">
            <properties>
              <help>NetFlow settings</help>
            </properties>
            <children>
              #include <include/generic-interface-multi.xml.i>
              <leafNode name="engine-id">
                <properties>
                  <help>NetFlow engine-id</help>
                  <valueHelp>
                    <format>0-255 or 0-255:0-255</format>
                    <description>NetFlow engine-id for v5</description>
                  </valueHelp>
                  <valueHelp>
                    <format>u32</format>
                    <description>NetFlow engine-id for v9 / IPFIX</description>
                  </valueHelp>
                  <constraint>
                   <regex>(\d|[1-9]\d{1,8}|[1-3]\d{9}|4[01]\d{8}|42[0-8]\d{7}|429[0-3]\d{6}|4294[0-8]\d{5}|42949[0-5]\d{4}|429496[0-6]\d{3}|4294967[01]\d{2}|42949672[0-8]\d|429496729[0-5])$|^(\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5]):(\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])</regex>
                  </constraint>
                </properties>
              </leafNode>
              <leafNode name="max-flows">
                <properties>
                  <help>NetFlow maximum flows</help>
                  <valueHelp>
                    <format>u32</format>
                    <description>NetFlow maximum flows</description>
                  </valueHelp>
                  <constraint>
                   <validator name="numeric" argument="--range 0-4294967295"/>
                  </constraint>
                </properties>
              </leafNode>
              <leafNode name="sampling-rate">
                <properties>
                  <help>NetFlow sampling-rate</help>
                  <valueHelp>
                    <format>u32</format>
                    <description>Sampling rate (1 in N packets)</description>
                  </valueHelp>
                  <constraint>
                   <validator name="numeric" argument="--range 0-4294967295"/>
                  </constraint>
                </properties>
              </leafNode>
              <leafNode name="version">
                <properties>
                  <help>NetFlow version to export</help>
                  <completionHelp>
                    <list>5 9 10</list>
                  </completionHelp>
                  <valueHelp>
                    <format>5</format>
                    <description>NetFlow version 5</description>
                  </valueHelp>
                  <valueHelp>
                    <format>9</format>
                    <description>NetFlow version 9</description>
                  </valueHelp>
                  <valueHelp>
                    <format>10</format>
                    <description>Internet Protocol Flow Information Export (IPFIX)</description>
                  </valueHelp>
                </properties>
                <defaultValue>9</defaultValue>
              </leafNode>
              <tagNode name="server">
                <properties>
                  <help>NetFlow destination server</help>
                  <valueHelp>
                    <format>ipv4</format>
                    <description>IPv4 server to export NetFlow</description>
                  </valueHelp>
                  <valueHelp>
                    <format>ipv6</format>
                    <description>IPv6 server to export NetFlow</description>
                  </valueHelp>
                  <constraint>
                    <validator name="ip-address"/>
                  </constraint>
                </properties>
                <children>
                  <leafNode name="port">
                    <properties>
                      <help>NetFlow port number</help>
                      <valueHelp>
                        <format>u32:1025-65535</format>
                        <description>NetFlow port number</description>
                      </valueHelp>
                      <constraint>
                       <validator name="numeric" argument="--range 1025-65535"/>
                      </constraint>
                    </properties>
                    <defaultValue>2055</defaultValue>
                  </leafNode>
                  #include <include/source-address-ipv4-ipv6.xml.i>
                  #include <include/source-interface.xml.i>
                </children>
              </tagNode>
              <leafNode name="inactive-timeout">
                <properties>
                  <help>Flow inactivity timeout</help>
                  <valueHelp>
                    <format>u32:0-2147483647</format>
                    <description>Inactive flow export timeout (seconds)</description>
                  </valueHelp>
                  <constraint>
                    <validator name="numeric" argument="--range 0-2147483647"/>
                  </constraint>
                </properties>
                <defaultValue>15</defaultValue>
              </leafNode>
              <leafNode name="active-timeout">
                <properties>
                  <help>Flow activity timeout</help>
                  <valueHelp>
                    <format>u32:0-2147483647</format>
                    <description>Active flow export timeout (seconds)</description>
                  </valueHelp>
                  <constraint>
                    <validator name="numeric" argument="--range 0-2147483647"/>
                  </constraint>
                </properties>
                <defaultValue>1800</defaultValue>
              </leafNode>
            </children>
          </node>
          #include <include/interface/vrf.xml.i>
        </children>
      </node>
    </children>
  </node>
</interfaceDefinition>
